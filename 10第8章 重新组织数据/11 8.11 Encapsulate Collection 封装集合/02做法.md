# 做法

<br>

- 加入为集合添加/移除元素的函数。
- 将保存集合的字段初始化为一个空集合。
- 编译。
- 找出集合设值函数的所有调用者。你可以修改那个设值函数，让它使用上述新建立的“添加／移除元素”函数；也可以直接修改调用端，改让它们调用上述新建立的“添加／移除元素”函数。
  - ⇒两种情况下需要用到集合设值函数：(1)集合为空时；(2)准备将原有集合替换为另一个集合时。
  - ⇒你或许会想运用`Rename Method (273)`为集合设值函数改名：从`setXxx()` 改为`initializexxx()`或`replacexxx()`。
- 编译，测试。
- 找出所有“通过取值函数获得集合并修改其内容”的函数。逐一修改这些函数，让它们改用添加／移除函数。每次修改后，编译并测试。
- 修改完上述所有“通过取值函数获得集合并修改集合内容”的函数后，修改取值函数自身，使它返回该集合的一个只读副本。
  - ⇒在`Java 2`中，你可以使用`Collection.unmodifiablexxx()`得到该集合的只读副本。
  - ⇒在`Java 1.1`中，你应该返回集合的一份副本。
- 编译，测试。
- 找出取值函数的所有用户，从中找出应该存在于集合所属对象内的代码。运用`Extract Method (110)`和`Move Method (142)`将这些代码移到宿主对象去。
  - ⇒如果你使用`Java 2`，那么本项重构到此为止。如果你使用`Java 1.1`，那么用户也许会喜欢使用枚举。为了提供这个枚举，你应该像如下这样做。
- 修改现有取值函数的名字，然后添加一个新取值函数，使其返回一个枚举。找出旧取值函数的所有被使用点，将它们都改为使用新取值函数。
- 如果这一步跨度太大，你可以先使用`Rename Method (273)`修改原取值函数的名称；再建立一个新取值函数用以返回枚举；最后再修改所有调用者，使其调新取值函数。
- 编译，测试。

<br>

